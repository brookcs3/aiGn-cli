name: Secret Scan

on:
  push:
  pull_request:

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Scan for obvious secrets
        shell: bash
        run: |
          set -euo pipefail
          if git ls-files -z | xargs -0 grep -nE "(XAI_API_KEY=|ANTHROPIC_API_KEY=|OPENAI_API_KEY=|GEMINI_API_KEY=|AIza[A-Za-z0-9_-]{10,}|sk-[A-Za-z0-9_-]{10,}|xai-[A-Za-z0-9_-]{10,})"; then
            echo "Potential secrets found in tracked files. Remove them or use .env/.env.example."
            exit 1
          fi
          if git ls-files --error-unmatch .env >/dev/null 2>&1; then
            echo ".env is tracked. Remove it from git and keep it local only."
            exit 1
          fi
